<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no,viewport-fit=cover">
  <title>MarketLab WebApp</title>
  <script src="https://telegram.org/js/telegram-web-app.js"></script>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    :root{color-scheme:light;--safe-area-inset-bottom:0px}
    *,*::before,*::after{box-sizing:border-box}
    html,body{margin:0;padding:0;height:100dvh;width:100dvw;overflow:hidden;background:#f5f5f5;font-family:-apple-system,BlinkMacSystemFont,'Segoe UI',sans-serif}
    body{position:relative;color:#000}
    .no-scrollbar::-webkit-scrollbar{display:none}
    .no-scrollbar{-ms-overflow-style:none;scrollbar-width:none}

    .field-label{font-size:14px;font-weight:395;color:#919191;line-height:1.3;margin-bottom:4px}
    .field-value{font-size:18px;font-weight:405;color:#000;line-height:1.3}
    .field-value.single-line{display:block;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}
    .section-title{font-size:14px;font-weight:457;color:#a8a8a8;line-height:1.3}
    .menu-item{font-size:14px;font-weight:556;color:#000;line-height:1.3}

    .section-wrapper{padding:0 12px}
    @media(min-width:768px){.section-wrapper{padding:0 calc(50vw - 360px)}}

    .icon-bg{width:32px;height:32px;background:#f0faff;border-radius:999px;display:flex;align-items:center;justify-content:center}
    .icon-img{width:16px;height:16px;object-fit:contain}
    .menu-icon-row{gap:6px}
    .menu-end-row{gap:6px}
    .menu-end-inner{gap:6px}
    .chevron-right-icon{width:16px;height:16px;object-fit:contain!important}

    [data-account-only]{display:none}
    html.tab-account [data-account-only]{display:block}

    #profileContainer,#avatar,#nameBadge,#scrollArea{transition:transform .45s cubic-bezier(.22,.61,.36,1),opacity .45s cubic-bezier(.22,.61,.36,1);will-change:transform,opacity;transform:translateZ(0);backface-visibility:hidden;contain:layout paint style}
    #avatar{transition:opacity .45s cubic-bezier(.22,.61,.36,1),transform .45s cubic-bezier(.22,.61,.36,1),filter .45s ease}
    #avatar img{width:100%;height:100%;object-fit:cover;border-radius:inherit}

    #profileContainer{position:absolute;left:50%;top:101px;transform:translateX(-50%);width:172px;height:131px;z-index:30}
    #avatar{position:absolute;left:41px;top:0;width:90px;height:90px;background:#fff;border-radius:999px;overflow:hidden;border:3.5px solid #fff;box-shadow:0 10px 25px rgba(0,0,0,.2)}
    #nameBadge{position:absolute;left:0;top:98px;width:172px;height:30px;background:#fff;border-radius:999px;font-size:18px;font-weight:556;color:#000;box-shadow:0 4px 12px rgba(0,0,0,.1);display:flex;align-items:center;justify-content:center}
    #scrollArea{position:absolute;left:0;right:0;top:245px;bottom:0;overflow-y:auto;padding-bottom:110px}

    .bottom-nav{position:fixed;bottom:0;left:0;right:0;height:96px;padding-bottom:calc(max(env(safe-area-inset-bottom),var(--safe-area-inset-bottom))+20px);pointer-events:none;z-index:1000}
    .glass-nav{position:absolute;bottom:max(env(safe-area-inset-bottom),20px);left:50%;transform:translateX(-50%);width:370px;height:66px;border-radius:24px;overflow:hidden;pointer-events:auto;background:rgba(255,255,255,0.52);backdrop-filter:blur(14px);-webkit-backdrop-filter:blur(14px);border:1px solid rgba(255,255,255,0.4);box-shadow:0 8px 32px rgba(0,0,0,0.08),0 2px 8px rgba(0,0,0,0.06)}
    .glass-nav::before{content:'';position:absolute;top:0;left:8px;right:8px;height:1px;background:linear-gradient(90deg,transparent,rgba(255,255,255,0.9),transparent);opacity:0.7}
    .nav-items{position:absolute;inset:0;display:flex;justify-content:center;align-items:center;gap:48px;padding:0 30px}
    .nav-item{position:relative;width:40px;height:40px;display:flex;align-items:center;justify-content:center;transition:transform .25s cubic-bezier(.22,.61,.36,1)}
    .nav-item:active{transform:scale(0.92)}
    .nav-item img{width:26px;height:26px;position:absolute;inset:0;margin:auto;transition:opacity .3s ease}
    .nav-item .inactive{opacity:1}
    .nav-item .active{opacity:0}
    .nav-item.active .inactive{opacity:0}
    .nav-item.active .active{opacity:1}

    .under-construction{position:absolute;inset:0;background:#f9f9f9;display:flex;flex-direction:column;align-items:center;justify-content:center;gap:16px;padding:40px;font-size:19px;color:#555;opacity:0;pointer-events:none;transition:opacity .4s ease}
    .under-construction.active{opacity:1;pointer-events:auto}
    .under-construction h2{font-size:32px;font-weight:700;color:#000;margin:0}

    #tab-profile .py-4{padding:12px 0!important}
    #tab-profile .py-4.flex.items-center.justify-between{min-height:56px}
  </style>
</head>
<body>
  <div class="fixed inset-0 bg-neutral-100">
    <div id="header" data-account-only class="absolute top-0 left-0 w-full bg-gradient-to-b from-[#d0ccff] to-[#8b82f5] z-20 overflow-hidden" style="height:146px">
      <img src="icons/skull_vector.svg" class="absolute top-0 left-0 w-[145px] h-[172px] pointer-events-none" alt="">
    </div>

    <div id="profileContainer" data-account-only>
      <div id="avatar"><img id="avatarImage" alt="–ê–≤–∞—Ç–∞—Ä"></div>
      <div id="nameBadge">A02-–ú–∞—Ä–∏–Ω–∞</div>
    </div>

    <div id="tab-profile" data-account-only hidden>
      <div id="scrollArea" class="no-scrollbar">
        <div class="section-wrapper">
          <div class="mt-2 mb-6">
            <div class="section-title ml-4 mb-2">–õ–ò–ß–ù–ê–Ø –ò–ù–§–û–†–ú–ê–¶–ò–Ø</div>
            <div class="bg-white rounded-2xl px-4 py-1 shadow-sm">
              <div class="py-4">
                <div class="field-label">–û—Ç–¥–µ–ª</div>
                <div class="field-value single-line mt-0.5">–ú–∞—Ä–∫–µ—Ç–∏–Ω–≥ –∏ –∫–æ–º–º—É–Ω–∏–∫–∞—Ü–∏–∏</div>
              </div>
              <hr class="border-neutral-200">
              <div class="py-4">
                <div class="field-label">–î–æ–ª–∂–Ω–æ—Å—Ç—å</div>
                <div class="field-value single-line mt-0.5">–ú–µ–Ω–µ–¥–∂–µ—Ä –∫–æ–º–º—É–Ω–∏–∫–∞—Ü–∏–π</div>
              </div>
              <hr class="border-neutral-200">
              <div class="py-4">
                <div class="field-label">–ü–æ—á—Ç–∞</div>
                <div class="field-value single-line mt-0.5">pashapashapasha@gmail.com</div>
              </div>
              <hr class="border-neutral-200">
              <div class="py-4">
                <div class="field-label">–°—Ç–∞–∂ —Ä–∞–±–æ—Ç—ã</div>
                <div class="field-value mt-0.5">5 –ª–µ—Ç 1 –º–µ—Å—è—Ü 15 –¥–Ω–µ–π</div>
              </div>
              <hr class="border-neutral-200">
              <div class="py-4 flex items-center justify-between">
                <div class="flex items-center menu-icon-row">
                  <div class="icon-bg"><img src="icons/icon_job.svg" class="icon-img" alt=""></div>
                  <div class="menu-item">–¢—Ä—É–¥–æ—É—Å—Ç—Ä–æ–π—Å—Ç–≤–æ</div>
                </div>
                <div class="flex items-center menu-end-row">
                  <span class="menu-item">–ù–µ –æ—Ñ–æ—Ä–º–ª–µ–Ω</span>
                  <img src="icons/vector_1.svg" class="chevron-right-icon" alt="">
                </div>
              </div>
            </div>
          </div>

          <div class="mt-0 mb-6">
            <div class="section-title ml-4 mb-2">–ó–ê–†–ü–õ–ê–¢–ê</div>
            <div class="bg-white rounded-2xl px-4 py-1 shadow-sm">
              <div class="py-4">
                <div class="field-label">–û–∫–ª–∞–¥</div>
                <div class="field-value mt-0.5">100 000 ‚ÇΩ</div>
              </div>
              <hr class="border-neutral-200">
              <div class="py-4 flex items-center justify-between">
                <div class="flex items-center menu-icon-row">
                  <div class="icon-bg"><img src="icons/shape.svg" class="icon-img" alt=""></div>
                  <div class="menu-item">–°–ø–æ—Å–æ–± –ø–æ–ª—É—á–µ–Ω–∏—è</div>
                </div>
                <div class="flex items-center menu-end-row">
                  <div class="flex items-center menu-end-inner">
                    <img src="icons/rapira_circle.svg" class="icon-img" alt="">
                    <span class="menu-item">–ö–æ–¥ Rapira</span>
                  </div>
                  <img src="icons/vector_1.svg" class="chevron-right-icon" alt="">
                </div>
              </div>
              <hr class="border-neutral-200">
              <div class="py-4 flex items-center justify-between">
                <div class="flex items-center menu-icon-row">
                  <div class="icon-bg"><img src="icons/union.svg" class="icon-img" alt=""></div>
                  <div class="menu-item">–ò—Å—Ç–æ—Ä–∏—è –Ω–∞—á–∏—Å–ª–µ–Ω–∏–π</div>
                </div>
                <img src="icons/vector_1.svg" class="chevron-right-icon" alt="">
              </div>
            </div>
          </div>
          <div class="h-96"></div>
        </div>
      </div>
    </div>

    <div id="under-construction" class="under-construction">
      <div style="font-size:92px">ü¶Ü</div>
      <h2>–†–∞–∑–¥–µ–ª –≤ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ</h2>
      <p>–°–∫–æ—Ä–æ –∑–¥–µ—Å—å –±—É–¥–µ—Ç —á—Ç–æ-—Ç–æ –∫—Ä—É—Ç–æ–µ</p>
    </div>

    <div class="bottom-nav">
      <div class="glass-nav">
        <div class="nav-items">
          <div class="nav-item" data-tab="1">
            <img src="icons/btn_1_inactive.svg" class="inactive" alt="–ì–ª–∞–≤–Ω–∞—è">
            <img src="icons/btn_1_active.svg" class="active" alt="–ì–ª–∞–≤–Ω–∞—è">
          </div>
          <div class="nav-item" data-tab="2">
            <img src="icons/btn_2_inactive.svg" class="inactive" alt="–ö–∞—Ç–∞–ª–æ–≥">
            <img src="icons/btn_2_active.svg" class="active" alt="–ö–∞—Ç–∞–ª–æ–≥">
          </div>
          <div class="nav-item" data-tab="3">
            <img src="icons/btn_3_inactive.svg" class="inactive" alt="–ó–∞–∫–∞–∑—ã">
            <img src="icons/btn_3_active.svg" class="active" alt="–ó–∞–∫–∞–∑—ã">
          </div>
          <div class="nav-item active" data-tab="4">
            <img src="icons/btn_4_inactive.svg" class="inactive" alt="–ü—Ä–æ—Ñ–∏–ª—å">
            <img src="icons/btn_4_active.svg" class="active" alt="–ü—Ä–æ—Ñ–∏–ª—å">
          </div>
        </div>
      </div>
    </div>
  </div>
  <script>
    (() => {
      const root = document.documentElement;
      const refs = {
        avatarImage: document.getElementById('avatarImage'),
        avatar: document.getElementById('avatar'),
        profileContainer: document.getElementById('profileContainer'),
        nameBadge: document.getElementById('nameBadge'),
        scrollArea: document.getElementById('scrollArea'),
        tabProfile: document.getElementById('tab-profile'),
        underConstruction: document.getElementById('under-construction'),
        navItems: Array.from(document.querySelectorAll('.nav-item'))
      };

      const cfg = {
        headerHeight: 146,
        badgeHeight: 30,
        badgeBottomOffset: 10,
        badgeStartTop: 98,
        profileStartTop: 101,
        scrollStartTop: 245,
        profileShiftRange: 70,
        scrollShiftRange: 140,
        scaleDelta: 0.35,
        blurMax: 5,
        maxScroll: 80
      };

      const state = {
        ticking: false,
        lastScrollTop: 0,
        direction: 'none',
        isPriming: false,
        hasPrimed: false,
        activeTab: null,
        tg: null,
        scrollEndTimer: null
      };

      const teardown = [];
      const clamp01 = value => Math.min(Math.max(value, 0), 1);
      const isAccountActive = () => root.classList.contains('tab-account');
      const progressFromScroll = () => clamp01(refs.scrollArea.scrollTop / cfg.maxScroll);

      const renderProgress = progress => {
        refs.profileContainer.style.top = `${cfg.profileStartTop - cfg.profileShiftRange * progress}px`;
        refs.scrollArea.style.top = `${cfg.scrollStartTop - cfg.scrollShiftRange * progress}px`;
        refs.avatar.style.opacity = `${1 - progress}`;
        refs.avatar.style.transform = `scale(${1 - cfg.scaleDelta * progress}) translateZ(0)`;
        refs.avatar.style.filter = `blur(${cfg.blurMax * progress}px)`;

        const targetBadgeTopInHeader = cfg.headerHeight - cfg.badgeBottomOffset - cfg.badgeHeight;
        const targetBadgeTopWithinContainer = targetBadgeTopInHeader - (cfg.profileStartTop - cfg.profileShiftRange * progress);
        const badgeTop = cfg.badgeStartTop + (targetBadgeTopWithinContainer - cfg.badgeStartTop) * progress;
        refs.nameBadge.style.top = `${badgeTop}px`;
      };

      const updateAnimatedState = progressOverride => {
        if (!isAccountActive()) return;
        const progress = progressOverride ?? progressFromScroll();
        renderProgress(progress);
      };

      const scheduleScrollEnd = () => {
        if (!isAccountActive() || state.isPriming) return;
        if (state.scrollEndTimer) clearTimeout(state.scrollEndTimer);
        state.scrollEndTimer = setTimeout(() => onScrollEnd(), 120);
      };

      const onScroll = () => {
        if (!isAccountActive() || state.ticking || state.isPriming) return;
        state.ticking = true;
        requestAnimationFrame(() => {
          const current = refs.scrollArea.scrollTop;
          state.direction = current > state.lastScrollTop ? 'down' : 'up';
          state.lastScrollTop = current;
          updateAnimatedState();
          state.ticking = false;
        });
        scheduleScrollEnd();
      };

      const onScrollEnd = () => {
        if (!isAccountActive() || state.isPriming) return;
        const top = refs.scrollArea.scrollTop;
        if (top > 0 && top < cfg.maxScroll) {
          refs.scrollArea.scrollTo({ top: state.direction === 'down' ? cfg.maxScroll : 0, behavior: 'smooth' });
        }
      };

      const initScroll = () => {
        if (!refs.scrollArea) return;
        refs.scrollArea.addEventListener('scroll', onScroll, { passive: true });
      };

      const triggerHaptic = () => {
        try {
          state.tg?.HapticFeedback?.impactOccurred('light');
        } catch (_) {}
      };

      const warmUpAnimation = () => {
        if (state.hasPrimed || !isAccountActive()) return;
        state.hasPrimed = true;
        state.isPriming = true;
        const frames = [0, 0.3, 0.6, 1, 0.35, 0];
        const drive = index => {
          if (index >= frames.length) {
            state.isPriming = false;
            updateAnimatedState(0);
            return;
          }
          requestAnimationFrame(() => {
            renderProgress(frames[index]);
            drive(index + 1);
          });
        };
        drive(0);
      };

      const ensurePrimed = () => {
        if (typeof window.requestIdleCallback === 'function') {
          window.requestIdleCallback(() => warmUpAnimation(), { timeout: 240 });
        } else {
          setTimeout(warmUpAnimation, 160);
        }
      };

      const setActiveTab = tabId => {
        state.activeTab = tabId;
        refs.navItems.forEach(item => item.classList.toggle('active', item.dataset.tab === tabId));
        const accountMode = tabId === '4';
        root.classList.toggle('tab-account', accountMode);
        refs.tabProfile.hidden = !accountMode;
        refs.underConstruction.classList.toggle('active', !accountMode);
        if (accountMode) {
          refs.scrollArea.scrollTop = 0;
          state.lastScrollTop = 0;
          updateAnimatedState(0);
          ensurePrimed();
        }
      };

      const handleNavClick = tabId => {
        if (state.activeTab === tabId) return;
        triggerHaptic();
        setActiveTab(tabId);
      };

      const registerNavHandlers = () => {
        refs.navItems.forEach(item => item.addEventListener('click', () => handleNavClick(item.dataset.tab)));
      };

      const initAvatar = user => {
        const src = user?.photo_url;
        if (!src) return;
        const preload = new Image();
        preload.decoding = 'async';
        preload.src = src;
        const apply = () => { refs.avatarImage.src = src; };
        preload.onload = apply;
        preload.onerror = apply;
      };

      const updateColors = () => {
        if (!state.tg) return;
        const theme = state.tg.themeParams || {};
        state.tg.setHeaderColor('#ffffff');
        state.tg.setBackgroundColor('#ffffff');
        root.style.setProperty('--tg-theme-bg-color', theme.bg_color || '#ffffff');
        root.style.setProperty('--tg-theme-text-color', theme.text_color || '#000000');
      };

      const registerTgEvent = (name, handler) => {
        if (!state.tg) return;
        state.tg.onEvent(name, handler);
        teardown.push(() => state.tg.offEvent(name, handler));
      };

      const handleSafeArea = () => {
        root.style.setProperty('--safe-area-inset-bottom', `${state.tg?.safeAreaInset?.bottom || 0}px`);
      };

      const enterFullscreenFlow = () => {
        if (!state.tg) return;
        if (!['android', 'ios'].includes(state.tg.platform) || !state.tg.isVersionAtLeast('8.0')) return;
        document.body.classList.add('mobile', `platform-${state.tg.platform}`);
        setTimeout(() => {
          state.tg.requestFullscreen().catch(() => state.tg.expand());
        }, 300);
        registerTgEvent('fullscreenChanged', () => {
          if (!state.tg.isFullscreen) {
            state.tg.requestFullscreen().catch(() => state.tg.expand());
          }
        });
        registerTgEvent('fullscreenFailed', () => state.tg.expand());
        registerTgEvent('safeAreaChanged', handleSafeArea);
        handleSafeArea();
      };

      const bootstrap = () => {
        state.tg = window.Telegram?.WebApp;
        if (!state.tg) return;
        state.tg.ready();
        state.tg.expand();
        state.tg.disableVerticalSwipes();
        initAvatar(state.tg.initDataUnsafe?.user || null);
        updateColors();
        enterFullscreenFlow();
        registerTgEvent('themeChanged', updateColors);
        setActiveTab('4');
      };

      registerNavHandlers();
      initScroll();
      setActiveTab('4');

      if (window.Telegram?.WebApp) {
        bootstrap();
      } else {
        window.addEventListener('TelegramWebAppReady', bootstrap, { once: true });
      }

      window.addEventListener('beforeunload', () => {
        teardown.forEach(fn => fn());
      });
    })();
  </script>
</body>
</html>
